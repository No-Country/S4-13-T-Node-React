import { useState } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { useAxios } from '../../../hooks/useAxios';
import { AxiosGetPostById } from '../../../interfaces';
import { handleModal } from '../../../redux/slice/modalSlice';
import { getPost } from '../../../redux/slice/postSlice';
import { addRemoveLike, UserDataState } from '../../../redux/slice/userDataSlice';
import { RootState } from '../../../redux/store';
import ButtonIcon from './ButtonIcon';
import ButtonsShare from './ButtonsShare';

const RightIcons = ({ id }: { id: number }) => {
  const dispatch = useDispatch();

  const [share, setShare] = useState(false);

  const { likes, data } = useSelector<RootState, UserDataState>(state => state.userDataReducer);

  const api = useAxios();

  const handleLike = () => {
    if (!data?.access_token) {
      dispatch(handleModal(true));
    } else {
      api
        .post(`/post/${id}/like`)
        .then(res => {
          if (res.status === 200) {
            dispatch(addRemoveLike({ post: { id } }));
            api
              .get(`/post/${id}`)
              .then(({ data }: AxiosGetPostById) => {
                const post = data.data.post;
                dispatch(getPost(post));
              })
              .catch(err => console.log(err));
          }
        })
        .catch(err => console.log(err));
    }
  };

  return (
    <div className="flex justify-cennter items-center gap-x-3 px-1">
      <div className={`flex transition-all gap-0 ${share ? 'gap-x-4' : ''}`} onClick={() => setShare(true)}>
        {share ? (
          <ButtonsShare id={id} />
        ) : (
          <ButtonIcon
            icon={
              <svg
                className="cursor-pointer"
                width="32"
                height="32"
                viewBox="0 0 32 32"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M23.3891 19.6292C22.6988 19.6326 22.0181 19.7879 21.3972 20.0835C20.7763 20.3791 20.2311 20.8076 19.8018 21.3373L13.0606 17.2072C13.3063 16.4301 13.3063 15.5984 13.0606 14.8213L19.8018 10.6912C20.486 11.5214 21.448 12.0876 22.5173 12.2893C23.5867 12.4911 24.6944 12.3154 25.6443 11.7934C26.5941 11.2714 27.3248 10.4367 27.7069 9.43734C28.0889 8.43794 28.0977 7.33827 27.7316 6.33314C27.3655 5.32801 26.6483 4.48229 25.7069 3.9458C24.7654 3.40931 23.6607 3.21667 22.5882 3.40202C21.5157 3.58737 20.5448 4.13873 19.8475 4.95844C19.1501 5.77815 18.7713 6.81329 18.7781 7.8805C18.7825 8.28464 18.8446 8.68619 18.9626 9.07345L12.2214 13.2036C11.6262 12.4694 10.8128 11.9348 9.89373 11.6739C8.97469 11.413 7.9956 11.4388 7.09218 11.7476C6.18876 12.0565 5.40576 12.6331 4.85171 13.3976C4.29766 14.1621 4 15.0765 4 16.0142C4 16.9519 4.29766 17.8664 4.85171 18.6308C5.40576 19.3953 6.18876 19.9719 7.09218 20.2808C7.9956 20.5897 8.97469 20.6154 9.89373 20.3546C10.8128 20.0937 11.6262 19.5591 12.2214 18.8249L18.9626 22.955C18.8446 23.3423 18.7825 23.7438 18.7781 24.1479C18.7781 25.0417 19.0486 25.9153 19.5552 26.6584C20.0619 27.4015 20.782 27.9807 21.6245 28.3227C22.4671 28.6647 23.3942 28.7542 24.2886 28.5798C25.183 28.4055 26.0046 27.9751 26.6495 27.3432C27.2943 26.7112 27.7335 25.9061 27.9114 25.0295C28.0893 24.153 27.998 23.2444 27.649 22.4187C27.3 21.593 26.709 20.8873 25.9508 20.3908C25.1925 19.8942 24.301 19.6292 23.3891 19.6292ZM23.3891 5.16926C23.9362 5.16926 24.4711 5.32827 24.9261 5.62619C25.381 5.9241 25.7356 6.34754 25.945 6.84296C26.1544 7.33837 26.2092 7.88351 26.1025 8.40944C25.9957 8.93537 25.7322 9.41847 25.3453 9.79764C24.9584 10.1768 24.4655 10.435 23.9288 10.5396C23.3921 10.6443 22.8359 10.5906 22.3303 10.3854C21.8248 10.1802 21.3927 9.83265 21.0887 9.38679C20.7848 8.94093 20.6225 8.41674 20.6225 7.8805C20.6225 7.16144 20.914 6.47182 21.4328 5.96337C21.9516 5.45491 22.6553 5.16926 23.3891 5.16926ZM8.63407 18.7255C8.0869 18.7255 7.55201 18.5665 7.09705 18.2685C6.64209 17.9706 6.28749 17.5472 6.0781 17.0518C5.86871 16.5564 5.81392 16.0112 5.92067 15.4853C6.02742 14.9594 6.2909 14.4763 6.67782 14.0971C7.06473 13.7179 7.55768 13.4597 8.09434 13.3551C8.631 13.2505 9.18726 13.3042 9.69279 13.5094C10.1983 13.7146 10.6304 14.0621 10.9344 14.5079C11.2384 14.9538 11.4006 15.478 11.4006 16.0142C11.4006 16.7333 11.1092 17.4229 10.5903 17.9314C10.0715 18.4398 9.36781 18.7255 8.63407 18.7255ZM23.3891 26.8592C22.8419 26.8592 22.307 26.7002 21.852 26.4023C21.3971 26.1043 21.0425 25.6809 20.8331 25.1855C20.6237 24.6901 20.5689 24.1449 20.6757 23.619C20.7824 23.0931 21.0459 22.61 21.4328 22.2308C21.8197 21.8516 22.3127 21.5934 22.8493 21.4888C23.386 21.3842 23.9423 21.4379 24.4478 21.6431C24.9533 21.8483 25.3854 22.1958 25.6894 22.6417C25.9934 23.0875 26.1556 23.6117 26.1556 24.1479C26.1556 24.867 25.8641 25.5566 25.3453 26.0651C24.8265 26.5735 24.1228 26.8592 23.3891 26.8592Z"
                  fill="#7F32EC"
                />
              </svg>
            }
            iconName="Compartir"
          />
        )}
      </div>
      <ButtonIcon
        icon={
          <svg
            className="cursor-pointer"
            width="32"
            height="32"
            viewBox="0 0 32 32"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            onClick={handleLike}
          >
            {likes.some(like => like.post.id == id) ? (
              <path
                d="M15.9971 27L21.9971 21L28.9971 12L28.4971 8.5L25.4971 5.5H19.4971L15.9971 8L13.4971 5.5L7.49707 5L3.99707 7.5L2.49707 12L10.4971 21.5L15.9971 27Z"
                fill="#FD8A09"
              />
            ) : (
              ''
            )}
            <path
              d="M22.4498 5.5C23.1779 5.49939 23.8988 5.64413 24.5702 5.92575C25.2416 6.20736 25.85 6.62018 26.3598 7.14C27.4102 8.20638 27.999 9.64316 27.999 11.14C27.999 12.6368 27.4102 14.0736 26.3598 15.14L15.9998 25.63L5.63978 15.14C4.58936 14.0736 4.00057 12.6368 4.00057 11.14C4.00057 9.64316 4.58936 8.20638 5.63978 7.14C6.14987 6.62055 6.75836 6.20795 7.42969 5.92629C8.10103 5.64464 8.82175 5.49957 9.54978 5.49957C10.2778 5.49957 10.9986 5.64464 11.6699 5.92629C12.3412 6.20795 12.9497 6.62055 13.4598 7.14L15.9998 9.74L18.5298 7.16C19.0381 6.63398 19.6472 6.21586 20.3207 5.93064C20.9942 5.64542 21.7184 5.49895 22.4498 5.5ZM22.4498 3.5C21.4554 3.49916 20.4709 3.69686 19.5539 4.0815C18.637 4.46615 17.806 5.03 17.1098 5.74L15.9998 6.86L14.8898 5.74C14.1928 5.03129 13.3616 4.46841 12.4448 4.08419C11.528 3.69997 10.5439 3.5021 9.54978 3.5021C8.55572 3.5021 7.5716 3.69997 6.65479 4.08419C5.73798 4.46841 4.90683 5.03129 4.20978 5.74C2.79166 7.18363 1.99707 9.12636 1.99707 11.15C1.99707 13.1736 2.79166 15.1164 4.20978 16.56L15.9998 28.5L27.7898 16.56C29.2079 15.1164 30.0025 13.1736 30.0025 11.15C30.0025 9.12636 29.2079 7.18363 27.7898 5.74C27.0929 5.03091 26.2619 4.46765 25.3451 4.08306C24.4282 3.69848 23.444 3.50028 22.4498 3.5Z"
              fill="#7F32EC"
            />
          </svg>
        }
        iconName="Me gusta"
      />
    </div>
  );
};

export default RightIcons;
